<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Status</title>
<style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f5f5f5; margin:0; height:100vh; display:flex; justify-content:center; align-items:center; color:#222; }
    .container { text-align:center; padding:28px; animation: fadeIn .35s ease; max-width:880px; }
    h1 { font-weight:900; margin:0; }
    .big { font-size:6rem; }
    .sub { margin-top:8px; font-size:1.05rem; opacity:.75; }
    .muted { opacity:.6; margin-top:10px; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }
    .err { color:#b00; }
    .small { font-size:.9rem; opacity:.6; margin-top:12px; }
    button.linklike { background:none; border:none; color:inherit; text-decoration:underline; cursor:pointer; padding:0; font:inherit; }
</style>
</head>
<body>
<div id="app"></div>

<script>
(function () {
    const RAW_URL = "https://raw.githubusercontent.com/rutujdhodapkar/Storage/main/access.csv";

    // cache-bust + force fresh
    const url = RAW_URL + (RAW_URL.includes('?') ? '&' : '?') + 't=' + Date.now();

    // Helper UI mounts
    function mount(html) { document.getElementById('app').innerHTML = html; }

    function show404() {
        mount(`
            <div class="container">
                <h1 class="big">404</h1>
                <p class="sub">The resource requested could not <button class="linklike" style="text-decoration:none; cursor:text;" onclick="redirect()">be</button> found on this server.</p>
            </div>
        `);
    }

    function showDenied() {
        mount(`
            <div class="container">
                <h1 style="font-size:2.4rem;">This is a private website.</h1>
                <h1 style="font-size:2.4rem;">Access denied.</h1>
                <p class="muted">Contact Rutuj Dhodapkar to get access.</p>
            </div>
        `);
    }

    function showFetchError(status, text) {
        mount(`<div class="container">
            <p class="err">Error fetching access.csv. Status: ${status}</p>
            <p class="small">Console has details.</p>
        </div>`);
        console.error("Fetch failed:", status, text);
    }

    window.redirect = function() {
        // keep the original redirect target
        window.location.href = "https://vgrnyiuiovnuionyioviohc8eryb.netlify.app/";
    };

    fetch(url, { cache: "no-store", mode: "cors", redirect: "follow" })
        .then(async res => {
            const text = await res.text().catch(() => "");
            console.log("FETCH STATUS:", res.status, "OK:", res.ok);
            console.log("RAW CONTENT:", JSON.stringify(text.slice(0,200))); // truncated dump

            if (!res.ok) {
                // sometimes GitHub returns HTML error pages; show helpful message
                showFetchError(res.status, text);
                return;
            }

            // Remove BOM, normalize whitespace, lowercase
            const cleaned = text.replace(/^\uFEFF/, "").trim().toLowerCase();

            // Find the first standalone token 'yes' or 'no' (word boundary)
            const match = cleaned.match(/\b(yes|no)\b/);

            if (match && match[1]) {
                const value = match[1];
                console.log("PARSED VALUE:", value);
                if (value === "yes") show404();
                else showDenied();
            } else {
                // no explicit yes/no found â€” show helpful debug so you can fix the CSV content
                mount(`<div class="container">
                    <p class="err">Invalid CSV value. expected "yes" or "no".</p>
                    <p class="small">File contents (first 200 chars):</p>
                    <pre class="small" style="max-width:640px; white-space:pre-wrap; text-align:left;">${escapeHtml(cleaned.slice(0,200))}</pre>
                </div>`);
                console.warn("Invalid access.csv content:", cleaned);
            }
        })
        .catch(err => {
            mount(`<div class="container"><p class="err">Network / fetch error.</p><p class="small">Open console for details.</p></div>`);
            console.error("Fetch error:", err);
        });

    // small helper to avoid injecting raw HTML
    function escapeHtml(s) {
        return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }
})();
</script>
</body>
</html>
